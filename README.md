# Pipelight Helpers

**Self-hosted automation pipelines.**
These are the javascript/typescript functions to help define trivial tests and deployments.

[Helpers Documentation](https://pipelight.dev/helpers/composition).

## Overview

Helpers are functions that take an Object as argument and generate executable strings for pipelight to process.
They are presented from the lowest to the highest level of abstraction they provide.

## Common helpers

Define pipelines quicker.

```ts
// define a pipeline
pipeline("deploy", () => [
  // define steps and add your bash commands
  step("build", () => ["vite build"]),
]);
```

Send commands to remotes.

```ts
step("build", () => ssh([host], ["nginx -t", "systemclt restart nginx"])),
```

Early exec some commands to process the result.

```ts
const pwd = await exec("pwd");
```

## Docker helpers

Edit a Docker Object.

```ts
const docker = new Docker({
  containers: [
    {
      name: "my_container",
      image: {
        name: "node:latest",
      },
    },
  ],
});
```

Add autogenerated bash commands to your pipeline.

```ts
pipeline("deploy", () => [
  // add bash commands autogenerated by the docker helper
  step("create:containers", () => [docker.images.create()]),
  step("create:containers", () => [docker.containers.create()]),
]);
```

## Service helpers (alpha)

Made on top of **docker helpers**

Set global variables and then only declare containers.
It will auto create and link images,volumes and networks.

Here we tend to use suffix instead of names.
Using suffix will autogenerate names based on suffix and globals to avoid colisions.

You can still use a ressource name (full name) if you want to link a known network or volume to a container.

```ts
const service = new Service({
  globals:{
    version: "production",
    dns: "example.com"
  },
  containers: [
    {
      suffix: "api",
      image: {
        name: "node:latest",
      },
      volume: {
        suffix: "vol",
        path: {
          inside: "/path/in/container/data",
        },
      },
      network:{
        suffix: "net"
        ip: "172.20.40.4"
      }
    },
    {
      suffix: "front",
      image: {
        suffix: "front",
      },
      volume: {
        suffix: "vol",
        path: {
          inside: "/path/in/container/data",
        },
      },
      network:{
        suffix: "net"
        ip: "172.20.40.2"
      }
    },
  ],
});
```

Add autogenerated bash commands to your pipeline.

```ts
pipeline("deploy", () => [
  // add bash commands autogenerated by the docker helper
  step("bring full container architecture up", () => [service.up()]),
]);
```

Or use the internal Docker Object to tweak the commands.
For example if you want to build images locally.

```ts
step("create:images", ()=>
service.docker.images.create()
)
step("send:images", ()=>
    service.docker.images.send([host])
)
step("create:containers:on_remote", ()=>
    ssh([host],[
    ...service.docker.network.remove()
    ...service.docker.network.create()
    ...service.docker.volumes.create()
    ...service.docker.containers.create()
    ])
)
```
